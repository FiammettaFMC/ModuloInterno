/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data"],(function(t,e,r){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=5)}([function(e,r){e.exports=t},function(t,e,r){"use strict";r.d(e,"b",(function(){return o})),r.d(e,"a",(function(){return i})),r.d(e,"c",(function(){return u})),r.d(e,"d",(function(){return s}));var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function o(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function i(t,e,r,n){return new(r||(r=Promise))((function(o,i){function u(t){try{a(n.next(t))}catch(t){i(t)}}function s(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(u,s)}a((n=n.apply(t,e||[])).next())}))}function u(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}},function(t,r){t.exports=e},function(t,e){t.exports=r},,function(t,e,r){"use strict";r.r(e);var n=r(3),o=r(1),i=r(0),u=r.n(i),s=function(){function t(){this.data=[]}return t.prototype.clear=function(){this.data=[]},t.prototype.size=function(){return this.data.length},t}(),a=function(){function t(t){this.index=0,this.data=t}return t.prototype.next=function(){return this.index<this.data.size()?this.data.getAt(this.index++):null},t}(),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.b)(e,t),e.prototype.addValues=function(t){this.data.push([t.a,t.b,t.time])},e.prototype.getAt=function(t){return{a:this.data[t][0],b:this.data[t][1],time:this.data[t][2]}},e.fromSeries=function(t){var r,n;if(!t[0]||!t[1])throw Error("Set at least 2 query before");var i=t[0].fields[1].values.toArray(),u=[];t.forEach((function(t){u.push(t.fields[0].values.toArray())}));var s=new e;try{for(var a=Object(o.d)(i.keys()),p=a.next();!p.done;p=a.next()){var c=p.value;s.addValues({a:u[0][c],b:u[1][c],time:i[c]})}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return s},e}(s),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.b)(e,t),e}(a),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.b)(e,t),e.prototype.addValues=function(t){this.data.push([t.value,t.time])},e.prototype.getAt=function(t){return{value:this.data[t][0],time:this.data[t][1]}},e}(s),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.b)(e,t),e}(a),d=function(){function t(){}return t.prototype.predict=function(t,e){var r=1-(e.getOpt().getToPredict()||0),n=e.getCoefficients(),o=new l;if(!t)throw Error("Data not found");for(var i,u,s=new c(t);i=s.next();)o.addValues({value:(u=0===r?i.a:i.b,u?u*n[0]+n[1]:0),time:i.time});return o},t}(),h=function(){function t(){}return t.prototype.predict=function(t,e){var r=e.getOpt().getFirstQuery()||0,n=e.getCoefficients(),o=function(t,e){return t*n[0]+e*n[1]+n[2]},i=new l;if(!t)throw Error("Data not found");for(var u,s=new c(t);u=s.next();){var a=0===r?o(u.a,u.b):o(u.b,u.a),p=0===a?0:a>0?1:-1;i.addValues({value:p,time:u.time})}return i},t}(),y=r(2),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.b)(e,t),e}(i.PureComponent),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.b)(e,t),e.prototype.getSeriesNames=function(){return this.props.data.series.map((function(t){return t.name||"unknown"}))},e.prototype.renderQueryOptions=function(){var t,e,r,n=this.getSeriesNames(),i=[];try{for(var s=Object(o.d)(n.keys()),a=s.next();!a.done;a=s.next()){var p=a.value;i.push(u.a.createElement("option",{value:p,selected:(null===(r=this.predictor)||void 0===r?void 0:r.getOpt().getToPredict())===p},n[p]))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}return i},e.prototype.setToPredict=function(t){var e;(null===(e=this.props.options.predictor)||void 0===e?void 0:e.getOpt()).setToPredict(Number.parseInt(t,10)),this.render()},e.prototype.render=function(){var t,e,r,n,o=this;return this.predictor=this.props.options.predictor,(null===(t=this.predictor)||void 0===t?void 0:t.getOpt().getToPredict())||null===(e=this.predictor)||void 0===e||e.getOpt().setToPredict(0),u.a.createElement(y.PanelOptionsGroup,{title:"RL"},u.a.createElement("p",null,(null===(r=this.predictor)||void 0===r?void 0:r.getPredFun())?"Function: "+(null===(n=this.predictor)||void 0===n?void 0:n.getPredFun()):""),u.a.createElement("label",{className:"gf-form-label width-10",style:{display:"inline-block"}}," ","y (value to predict)"," "),u.a.createElement("div",{className:"gf-form-select-wrapper width-10",style:{display:"inline-block"}},u.a.createElement("select",{className:"input-small gf-form-input",onChange:function(t){return o.setToPredict(t.target.value)}},this.renderQueryOptions())))},e}(m),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.b)(e,t),e.prototype.getSeriesNames=function(){return this.props.data.series.map((function(t){return t.name||"unknown"}))},e.prototype.renderQueryOptions=function(){var t,e,r,n=this.getSeriesNames(),i=[];try{for(var s=Object(o.d)(n.keys()),a=s.next();!a.done;a=s.next()){var p=a.value;i.push(u.a.createElement("option",{value:p,selected:(null===(r=this.predictor)||void 0===r?void 0:r.getOpt().getFirstQuery())===p},n[p]))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}return i},e.prototype.setFirstQuery=function(t){var e;(null===(e=this.props.options.predictor)||void 0===e?void 0:e.getOpt()).setFirstQuery(Number.parseInt(t,10)),this.render()},e.prototype.render=function(){var t,e,r,n,o=this;return this.predictor=this.props.options.predictor,(null===(t=this.predictor)||void 0===t?void 0:t.getOpt().getFirstQuery())||null===(e=this.predictor)||void 0===e||e.getOpt().setFirstQuery(0),u.a.createElement(y.PanelOptionsGroup,{title:"SVM"},u.a.createElement("p",null,(null===(r=this.predictor)||void 0===r?void 0:r.getPredFun())?"Function: "+(null===(n=this.predictor)||void 0===n?void 0:n.getPredFun()):""),u.a.createElement("label",{className:"gf-form-label width-10",style:{display:"inline-block"}}," ","x1 (first query)"," "),u.a.createElement("div",{className:"gf-form-select-wrapper width-10",style:{display:"inline-block"}},u.a.createElement("select",{className:"input-small gf-form-input",onChange:function(t){return o.setFirstQuery(t.target.value)}},this.renderQueryOptions())))},e}(m),b=function(){function t(){}return t.prototype.fromJSON=function(t){return this.order=t.order,this.precision=t.precision,this.toPredict=t.toPredict||0,this},t.prototype.getOrder=function(){return this.order},t.prototype.getPrecision=function(){return this.precision},t.prototype.getToPredict=function(){return this.toPredict},t.prototype.setToPredict=function(t){this.toPredict=t},t}(),O=function(){function t(){}return t.prototype.fromJSON=function(t){return this.C=t.C,this.maxiter=t.maxiter,this.numpass=t.numpass,this.firstQuery=t.firstQuery||0,this},t.prototype.getC=function(){return this.C},t.prototype.getMaxIter=function(){return this.maxiter},t.prototype.getNumPass=function(){return this.numpass},t.prototype.getFirstQuery=function(){return this.firstQuery},t.prototype.setFirstQuery=function(t){this.firstQuery=t},t}(),w={RL:new d,SVM:new h},P={RL:v,SVM:g},E={RL:new b,SVM:new O},S=function(){function t(){}return t.prototype.setData=function(t){this.data=t},t.prototype.setPredictor=function(t){if(this.predictor=t,!w[t.getAlgorithm()])throw Error("Wrong algorithm");this.strategy=w[t.getAlgorithm()]},t.prototype.predict=function(){var t;if(!this.data||!this.predictor)throw Error("Predictor not found");if(this.predicted=null===(t=this.strategy)||void 0===t?void 0:t.predict(this.data,this.predictor),!this.predicted||this.predicted.size()<1)throw Error("Data not predicted");return this.predicted.getAt(this.predicted.size()-1).value},t.prototype.saveToInflux=function(){return Object(o.a)(this,void 0,void 0,(function(){var t,e;return Object(o.c)(this,(function(r){if(!this.predicted)throw Error("data.predicted not found");for(t=new f(this.predicted);e=t.next();)$.post({url:"http://localhost:8086/write?db=telegraf",data:"prediction value="+e.value+" "+e.time+"000000"});return[2]}))}))},t}(),x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pause=function(){e.props.pause(),e.btn_stop&&(e.btn_stop.hidden=!0),e.btn_start&&(e.btn_start.hidden=!1)},e.start=function(){e.props.start(),e.btn_stop&&(e.btn_stop.hidden=!1),e.btn_start&&(e.btn_start.hidden=!0)},e}return Object(o.b)(e,t),e.prototype.componentDidMount=function(){this.btn_stop=document.getElementById("btn_stop"),this.btn_start=document.getElementById("btn_start")},e.prototype.render=function(){var t=this.props,e=t.algorithm,r=t.coefficients,n=t.opt,o=t.lastValue;return u.a.createElement("div",null,u.a.createElement("pre",null,"- Algorithm: ",e+"\n","- Coefficients: ",r+"\n",null!=n?"- Options: "+JSON.stringify(n)+"\n":""),u.a.createElement("div",{style:{textAlign:"center"}},u.a.createElement("h1",null,o),u.a.createElement("button",{id:"btn_stop",className:"btn btn-danger",onClick:this.pause},"Stop"),u.a.createElement("button",{id:"btn_start",className:"btn btn-success",onClick:this.start,hidden:!0},"Start")))},e}(i.PureComponent),N=function(){function t(t,e,r,n){this.algorithm=t,this.coefficients=e,this.predFun=r,this.opt=n}return t.prototype.getAlgorithm=function(){return this.algorithm},t.prototype.getCoefficients=function(){return this.coefficients},t.prototype.getPredFun=function(){return this.predFun},t.prototype.getOpt=function(){return this.opt},t.fromJSON=function(e){if(!e)throw Error("No file found");var r=JSON.parse(e),n=E[r.algorithm];if(!r.algorithm||!r.coefficients)throw Error("Error reading file");return new t(r.algorithm,r.coefficients,r.predFun||"",n.fromJSON(r.opt||{}))},t}(),_=function(t){function e(e){var r=t.call(this,e)||this;return r.paused=!1,r.model=new S,r}return Object(o.b)(e,t),e.prototype.setData=function(){var t=p.fromSeries(this.props.data.series);this.model.setData(t)},e.prototype.setPredictor=function(){this.props.options.predictor&&this.model.setPredictor(this.props.options.predictor)},e.prototype.predict=function(){this.lastValue=this.model.predict()},e.prototype.saveToInflux=function(){this.model.saveToInflux()},e.prototype.pause=function(){this.paused=!0},e.prototype.start=function(){this.paused=!1},e.prototype.updatePrediction=function(){this.setData(),this.setPredictor(),this.predict(),this.saveToInflux()},e.prototype.parsePredictor=function(){var t;try{null===(t=this.props.options.predictor)||void 0===t||t.getAlgorithm()}catch(t){var e=this.props.options.predictor;this.props.options.predictor=N.fromJSON(JSON.stringify(e))}},e.prototype.render=function(){var t=this;if(this.parsePredictor(),!this.props.options.predictor)return u.a.createElement("p",null," Select a predictor ");this.paused||this.updatePrediction();var e=this.props.options.predictor;return u.a.createElement("div",null,u.a.createElement(x,{algorithm:e.getAlgorithm(),coefficients:e.getCoefficients(),opt:e.getOpt(),lastValue:this.lastValue,pause:function(){return t.pause()},start:function(){return t.start()}}))},e}(i.PureComponent);function j(t){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var F=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.b)(e,t),e.prototype.importPredictor=function(t){var e=this,r=new FileReader;if(null==t.files)throw new Error("File not selected");r.readAsText(t.files[0]),r.onload=function(t){var r,n;try{e.props.options.predictor=N.fromJSON(null===(n=null===(r=t.target)||void 0===r?void 0:r.result)||void 0===n?void 0:n.toString())}catch(t){alert(t)}e.render()}},e.prototype.parsePredictor=function(){var t;try{null===(t=this.props.options.predictor)||void 0===t||t.getAlgorithm()}catch(t){var e=this.props.options.predictor;this.props.options.predictor=N.fromJSON(JSON.stringify(e))}},e.prototype.render=function(){var t=this;this.parsePredictor();var e,r=this.props.options.predictor,n=null==r?void 0:r.getAlgorithm();return e=n&&P[n]?P[n]:j(u.a.PureComponent),u.a.createElement("div",null,u.a.createElement(y.PanelOptionsGrid,null,u.a.createElement(y.PanelOptionsGroup,{title:"Import predictor"},u.a.createElement("input",{className:"input gf-input gf-file",type:"file",name:"Import",id:"import",onChange:function(e){return t.importPredictor(e.target)}})),u.a.createElement(e,{data:this.props.data,options:this.props.options})))},e}(i.PureComponent);r.d(e,"plugin",(function(){return C}));var C=new n.PanelPlugin(_).setEditor(F)}])}));
//# sourceMappingURL=module.js.map