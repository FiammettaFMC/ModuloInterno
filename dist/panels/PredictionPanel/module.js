/*! For license information please see module.js.LICENSE.txt */
define(["react","@grafana/ui","@grafana/data"],(function(t,e,r){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=22)}([function(e,r){e.exports=t},function(t,e,r){"use strict";r.d(e,"b",(function(){return o})),r.d(e,"a",(function(){return i})),r.d(e,"c",(function(){return u})),r.d(e,"d",(function(){return s}));var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function o(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function i(t,e,r,n){return new(r||(r=Promise))((function(o,i){function u(t){try{a(n.next(t))}catch(t){i(t)}}function s(t){try{a(n.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(u,s)}a((n=n.apply(t,e||[])).next())}))}function u(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function s(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}},function(t,r){t.exports=e},function(t,e,r){"use strict";r.d(e,"a",(function(){return n})),r.d(e,"b",(function(){return o}));var n=function(){function t(){this.data=[]}return t.prototype.clear=function(){this.data=[]},t.prototype.size=function(){return this.data.length},t}(),o=function(){function t(t){this.index=0,this.data=t}return t.prototype.next=function(){return this.index<this.data.size()?this.data.getAt(this.index++):null},t}()},function(t,e,r){"use strict";var n=r(7),o=function(){function t(t,e,r,n,o){this.algorithm=t,this.coefficients=e,this.predFun=r,this.opt=n,o&&(this.accuracy=o)}return t.prototype.getAlgorithm=function(){return this.algorithm},t.prototype.getCoefficients=function(){return this.coefficients},t.prototype.getPredFun=function(){return this.predFun},t.prototype.getOpt=function(){return this.opt},t.prototype.getAcc=function(){return this.accuracy},t.prototype.setOpt=function(t){var e;null===(e=this.opt)||void 0===e||e.setValueFile(t)},t.fromJSON=function(e){if(!e)throw Error("No file found");var r=JSON.parse(e),o=n.b[r.algorithm];if(!r.algorithm||!r.coefficients)throw Error("Error reading file");return new t(r.algorithm,r.coefficients,r.predFun||"",o.fromJSON(r.opt||{}))},t.prototype.toJSON=function(){return'{\n    "GroupName": "ProApes",\n    "Version": "1.5",\n    "PluginName": "PredireInGrafana",\n    "algorithm": "'+this.algorithm+'",\n    "coefficients": ['+this.coefficients+'],\n    "predFun": "'+this.predFun+'",\n    "opt": '+JSON.stringify(this.opt)+',\n    "accuracy": "'+this.accuracy+'"\n}'},t}();e.a=o},function(t,e,r){"use strict";r.d(e,"a",(function(){return i})),r.d(e,"b",(function(){return u}));var n=r(1),o=r(3),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(n.b)(e,t),e.prototype.addValues=function(t){this.data.push([t.a,t.b,t.time])},e.prototype.getAt=function(t){return{a:this.data[t][0],b:this.data[t][1],time:this.data[t][2]}},e.fromSeries=function(t){var r,o;if(!t[0]||!t[1])throw Error("Set at least 2 query before");var i=t[0].fields[1].values.toArray(),u=[];t.forEach((function(t){u.push(t.fields[0].values.toArray())}));var s=new e;try{for(var a=Object(n.d)(i.keys()),c=a.next();!c.done;c=a.next()){var p=c.value;s.addValues({a:u[0][p],b:u[1][p],time:i[p]})}}catch(t){r={error:t}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(r)throw r.error}}return s},e}(o.a),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(n.b)(e,t),e}(o.b)},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return u}));var n=r(1),o=r(3),i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(n.b)(e,t),e.prototype.addValues=function(t){this.data.push([t.value,t.time])},e.prototype.getAt=function(t){return{value:this.data[t][0],time:this.data[t][1]}},e}(o.a),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(n.b)(e,t),e}(o.b)},function(t,e,r){"use strict";var n=r(5),o=r(6),i=function(){function t(){}return t.prototype.predict=function(t,e){var r=1-(e.getOpt().getToPredict()||0),i=e.getCoefficients(),u=new o.b;if(!t)throw Error("Data not found");for(var s,a,c=new n.b(t);s=c.next();)(s.a||s.b)&&u.addValues({value:(a=0===r?s.a:s.b,a?a*i[0]+i[1]:0),time:s.time});return u},t}(),u=function(){function t(){}return t.prototype.predict=function(t,e){var r=e.getOpt().getFirstQuery()||0,i=e.getCoefficients(),u=function(t,e){return t*i[0]+e*i[1]+i[2]},s=new o.b;if(!t)throw Error("Data not found");for(var a,c=new n.b(t);a=c.next();)if(a.a||a.b){var p=0===r?u(a.a,a.b):u(a.b,a.a),l=0===p?0:p>0?1:-1;s.addValues({value:l,time:a.time})}return s},t}(),s=r(1),a=r(0),c=r.n(a),p=r(2),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.b)(e,t),e}(a.PureComponent),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.b)(e,t),e.prototype.getSeriesNames=function(){return this.props.data.series.map((function(t){return t.name||"unknown"}))},e.prototype.renderQueryOptions=function(){var t,e,r,n=this.getSeriesNames(),o=[];try{for(var i=Object(s.d)(n.keys()),u=i.next();!u.done;u=i.next()){var a=u.value;o.push(c.a.createElement("option",{value:a,selected:(null===(r=this.predictor)||void 0===r?void 0:r.getOpt().getToPredict())===a},n[a]))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return o},e.prototype.setToPredict=function(t){var e;(null===(e=this.props.options.predictor)||void 0===e?void 0:e.getOpt()).setToPredict(Number.parseInt(t,10)),this.render()},e.prototype.render=function(){var t,e,r,n,o=this;return this.predictor=this.props.options.predictor,(null===(t=this.predictor)||void 0===t?void 0:t.getOpt().getToPredict())||null===(e=this.predictor)||void 0===e||e.getOpt().setToPredict(0),c.a.createElement(p.PanelOptionsGroup,{title:"RL"},c.a.createElement("p",null,(null===(r=this.predictor)||void 0===r?void 0:r.getPredFun())?"Function: "+(null===(n=this.predictor)||void 0===n?void 0:n.getPredFun()):""),c.a.createElement("label",{className:"gf-form-label width-10",style:{display:"inline-block"}}," ","y (value to predict)"," "),c.a.createElement("div",{className:"gf-form-select-wrapper width-10",style:{display:"inline-block"}},c.a.createElement("select",{className:"input-small gf-form-input",onChange:function(t){return o.setToPredict(t.target.value)}},this.renderQueryOptions())))},e}(l),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(s.b)(e,t),e.prototype.getSeriesNames=function(){return this.props.data.series.map((function(t){return t.name||"unknown"}))},e.prototype.renderQueryOptions=function(){var t,e,r,n=this.getSeriesNames(),o=[];try{for(var i=Object(s.d)(n.keys()),u=i.next();!u.done;u=i.next()){var a=u.value;o.push(c.a.createElement("option",{value:a,selected:(null===(r=this.predictor)||void 0===r?void 0:r.getOpt().getFirstQuery())===a},n[a]))}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return o},e.prototype.setFirstQuery=function(t){var e;(null===(e=this.props.options.predictor)||void 0===e?void 0:e.getOpt()).setFirstQuery(Number.parseInt(t,10)),this.render()},e.prototype.render=function(){var t,e,r,n,o=this;return this.predictor=this.props.options.predictor,(null===(t=this.predictor)||void 0===t?void 0:t.getOpt().getFirstQuery())||null===(e=this.predictor)||void 0===e||e.getOpt().setFirstQuery(0),c.a.createElement(p.PanelOptionsGroup,{title:"SVM"},c.a.createElement("p",null,(null===(r=this.predictor)||void 0===r?void 0:r.getPredFun())?"Function: "+(null===(n=this.predictor)||void 0===n?void 0:n.getPredFun()):""),c.a.createElement("label",{className:"gf-form-label width-10",style:{display:"inline-block"}}," ","x1 (first query)"," "),c.a.createElement("div",{className:"gf-form-select-wrapper width-10",style:{display:"inline-block"}},c.a.createElement("select",{className:"input-small gf-form-input",onChange:function(t){return o.setFirstQuery(t.target.value)}},this.renderQueryOptions())))},e}(l),h=r(8),y=r(9);r.d(e,"c",(function(){return m})),r.d(e,"a",(function(){return v})),r.d(e,"b",(function(){return b}));var m={RL:new i,SVM:new u},v={RL:f,SVM:d},b={RL:new h.a,SVM:new y.a}},function(t,e,r){"use strict";var n=function(){function t(){this.order=2,this.precision=2,this.toPredict=0}return t.prototype.fromJSON=function(t){return this.order=t.order,this.precision=t.precision,this.toPredict=t.toPredict||0,this},t.prototype.setValueFile=function(t){try{var e=JSON.parse(t);this.order=e.opt.order,this.precision=e.opt.precision}catch(t){throw new Error("Predictor bad formatted")}},t.prototype.getOrder=function(){return this.order},t.prototype.getPrecision=function(){return this.precision},t.prototype.getToPredict=function(){return this.toPredict},t.prototype.setPrecision=function(t){this.precision=t},t.prototype.setToPredict=function(t){this.toPredict=t},t}();e.a=n},function(t,e,r){"use strict";var n=function(){function t(){this.C=1,this.maxiter=1e4,this.numpass=10,this.firstQuery=0}return t.prototype.fromJSON=function(t){return this.C=t.C,this.maxiter=t.maxiter,this.numpass=t.numpass,this.firstQuery=t.firstQuery||0,this},t.prototype.setValueFile=function(t){try{var e=JSON.parse(t);this.C=e.opt.C,this.maxiter=e.opt.maxiter,this.numpass=e.opt.numpass}catch(t){throw new Error("Predictor bad formatted")}},t.prototype.getC=function(){return this.C},t.prototype.getMaxIter=function(){return this.maxiter},t.prototype.getNumPass=function(){return this.numpass},t.prototype.getFirstQuery=function(){return this.firstQuery},t.prototype.setC=function(t){this.C=t},t.prototype.setMaxIter=function(t){this.maxiter=t},t.prototype.setNumPass=function(t){this.numpass=t},t.prototype.setFirstQuery=function(t){this.firstQuery=t},t}();e.a=n},function(t,e){t.exports=r},,,,,,,,,,,,function(t,e,r){"use strict";r.r(e);var n=r(10),o=r(1),i=r(0),u=r.n(i),s=r(5),a=r(6),c=r(7),p=function(){function t(){}return t.prototype.setData=function(t){this.data=t},t.prototype.setPredictor=function(t){if(this.predictor=t,!c.c[t.getAlgorithm()])throw Error("Wrong algorithm");this.strategy=c.c[t.getAlgorithm()]},t.prototype.predict=function(){var t;if(!this.data||!this.predictor)throw Error("Predictor not found");if(this.predicted=null===(t=this.strategy)||void 0===t?void 0:t.predict(this.data,this.predictor),!this.predicted||this.predicted.size()<1)throw Error("Data not predicted");return this.predicted.getAt(this.predicted.size()-1).value},t.prototype.saveToInflux=function(){return Object(o.a)(this,void 0,void 0,(function(){var t,e;return Object(o.c)(this,(function(r){if(!this.predicted)throw Error("data.predicted not found");for(t=new a.a(this.predicted);e=t.next();)$.post({url:"http://localhost:8086/write?db=telegraf",data:"prediction value="+e.value+" "+e.time+"000000"});return[2]}))}))},t}(),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pause=function(){e.props.pause(),e.btn_stop&&(e.btn_stop.hidden=!0),e.btn_start&&(e.btn_start.hidden=!1)},e.start=function(){e.props.start(),e.btn_stop&&(e.btn_stop.hidden=!1),e.btn_start&&(e.btn_start.hidden=!0)},e}return Object(o.b)(e,t),e.prototype.componentDidMount=function(){this.btn_stop=document.getElementById("btn_stop"),this.btn_start=document.getElementById("btn_start")},e.prototype.render=function(){var t=this.props,e=t.algorithm,r=t.coefficients,n=t.opt,o=t.lastValue;return u.a.createElement("div",null,u.a.createElement("pre",null,"- Algorithm: ",e+"\n","- Coefficients: ",r+"\n",null!=n?"- Options: "+JSON.stringify(n)+"\n":""),u.a.createElement("div",{style:{textAlign:"center"}},u.a.createElement("h1",null,o),u.a.createElement("button",{id:"btn_stop",className:"btn btn-danger",onClick:this.pause},"Stop"),u.a.createElement("button",{id:"btn_start",className:"btn btn-success",onClick:this.start,hidden:!0},"Start")))},e}(i.PureComponent),f=r(4),d=function(t){function e(e){var r=t.call(this,e)||this;return r.paused=!1,r.model=new p,r}return Object(o.b)(e,t),e.prototype.setData=function(){var t=s.a.fromSeries(this.props.data.series);this.model.setData(t)},e.prototype.setPredictor=function(){this.props.options.predictor&&this.model.setPredictor(this.props.options.predictor)},e.prototype.predict=function(){this.lastValue=this.model.predict()},e.prototype.saveToInflux=function(){this.model.saveToInflux()},e.prototype.pause=function(){this.paused=!0},e.prototype.start=function(){this.paused=!1},e.prototype.updatePrediction=function(){this.setData(),this.setPredictor(),this.predict(),this.saveToInflux()},e.prototype.parsePredictor=function(){var t;try{null===(t=this.props.options.predictor)||void 0===t||t.getAlgorithm()}catch(t){var e=this.props.options.predictor;this.props.options.predictor=f.a.fromJSON(JSON.stringify(e))}},e.prototype.render=function(){var t=this;if(this.parsePredictor(),!this.props.options.predictor)return u.a.createElement("p",null," Select a predictor ");this.paused||this.updatePrediction();var e=this.props.options.predictor;return u.a.createElement("div",null,u.a.createElement(l,{algorithm:e.getAlgorithm(),coefficients:e.getCoefficients(),opt:e.getOpt(),lastValue:this.lastValue,pause:function(){return t.pause()},start:function(){return t.start()}}))},e}(i.PureComponent),h=r(2);function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.b)(e,t),e.prototype.importPredictor=function(t){var e=this,r=new FileReader;if(null==t.files)throw new Error("File not selected");r.readAsText(t.files[0]),r.onload=function(t){var r,n;try{e.props.options.predictor=f.a.fromJSON(null===(n=null===(r=t.target)||void 0===r?void 0:r.result)||void 0===n?void 0:n.toString())}catch(t){alert(t)}e.render()}},e.prototype.parsePredictor=function(){var t;try{null===(t=this.props.options.predictor)||void 0===t||t.getAlgorithm()}catch(t){var e=this.props.options.predictor;this.props.options.predictor=f.a.fromJSON(JSON.stringify(e))}},e.prototype.render=function(){var t=this;this.parsePredictor();var e,r=this.props.options.predictor,n=null==r?void 0:r.getAlgorithm();return e=n&&c.a[n]?c.a[n]:y(u.a.PureComponent),u.a.createElement("div",null,u.a.createElement(h.PanelOptionsGrid,null,u.a.createElement(h.PanelOptionsGroup,{title:"Import predictor"},u.a.createElement("input",{className:"input gf-input gf-file",type:"file",name:"Import",id:"import",onChange:function(e){return t.importPredictor(e.target)}})),u.a.createElement(e,{data:this.props.data,options:this.props.options})))},e}(i.PureComponent);r.d(e,"plugin",(function(){return v}));var v=new n.PanelPlugin(d).setEditor(m)}])}));
//# sourceMappingURL=module.js.map